<!DOCTYPE html>
<meta charset="utf-8">
<html lang="en-US"> <!-- This element is the root element of an HTML page -->

<head> 
	<title>berniweb</title>
	<meta charset="UTF-8">
	<meta name="description" content="Personal website (learning D3)">
	<meta name="keywords" content="HTML, CSS, XML, JavaScript, D3">
	<meta name="author" content="Bernat Bramon">
	<!--<meta http-equiv="refresh" content="100">-->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">


	<style>

		.node {
		  cursor: pointer;
		  stroke-width: 1.5px;
		}

		.node:hover {
		  stroke: #000;
		  stroke-width: 1.5px;
		/*idea: earth type shadding*/
		}

		.node--leaf {
		  fill: white;
		}

		.label {
		  font: 11px "Helvetica Neue", Helvetica, Arial, sans-serif;
		  text-anchor: middle;
		  text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff, 0 -1px 0 #fff;
		}

		.label,
		.node--root,
		.node--leaf {
		  pointer-events: none;
		}

		.clearfix {
		    clear: both;
		}
		#parent {
		   border: 2px solid green;
		   position: relative;
		   text-align: center;
		}

		#content {
		   position: absolute;
		   left: 0px;
		   top: 0px;
		   /* absolute position implies no width and height */
		   width: 100%;
		   height: 100%;
		   pointer-events: none;
		   text-align: center;
		}

	</style>
</head>

<body>
<div id="parent">
    <svg width="960" height="960"></svg>
    <div class="clearfix"></div>
    <div id="content"></div>
</div>


<script src="https://d3js.org/d3.v4.min.js"></script>
<script>


	var svg = d3.select("svg"),
	    margin = 20,
	    smallr = 3.5,
	    diameter = +svg.attr("width")

	var gtext = svg.append("g").attr("transform", "translate(" + diameter / 2 + "," + diameter / 2 + ")");

	  gtext.selectAll("text").data([1], function(d) {return d}).enter().append("text")
		.attr("id", "firstpage")
		.attr("x", 0)             
		.attr("y", -diameter/3.2)
		.attr("text-anchor", "middle")  
		.style("font-size", "38px") 
		.style("font-type", "Andale Mono")
		.text("Bernat Bramon Mora");


	  gtext.selectAll("text").data([2], function(d) {return d}).enter().append("text")
		.attr("id", "firstpage")
		.attr("x", 0)             
		.attr("y", -diameter/3.8)
		.attr("text-anchor", "middle")  
		.style("font-size", "18px") 
		.style("font-type", "Andale Mono")
		.style("font-style", "italic")
		.text("learning D3.js");

	  gtext.selectAll("text").data([3], function(d) {return d}).enter().append("text")
		.attr("id", "firstpage")
		.attr("x", 0)             
		.attr("y", +diameter/4)
		.attr("text-anchor", "middle")  
		.style("font-size", "18px")
		.style("font-type", "Andale Mono")
		.style("font-style", "italic")
		.text("bernat.bramon@gmail.com");


	var g = svg.append("g").attr("transform", "translate(" + diameter / 2 + "," + diameter / 2 + ")");

	var color = d3.scaleLinear()
	    .domain([-1, 5])
	    .range(["hsl(225,80%,80%)", "white"])
	    .interpolate(d3.interpolateHcl);

	var pack = d3.pack()
	    .size([diameter - margin, diameter - margin])
	    .padding(function(d) { 
		return d.data.padding || 2; 
		});

	d3.json("flare.json", function(error, root) {
	  if (error) throw error;

	  var root = d3.hierarchy(root)
	      .sum(function(d) { return d.size; })
	      .sort(function(a, b) { return b.value - a.value; });

	  var focus = root,
	      nodes_obj = pack(root).descendants(),
	      view;


	//Pattern definitions-------------------------------------------------------

	var defs = svg.append('svg:defs');
			defs.append("svg:pattern")
			.attr("id", "grump_avatar")
			.attr("width", 1)
			.attr("height", 1)
            		.attr('patternContentUnits', 'objectBoundingBox')
			.append("svg:image")
			.attr("xlink:href", "images/surfer.png")
			.attr("width", 1)
			.attr("height", 1)
		        .attr("x", 0)
		        .attr("y", 0)
			.attr("preserveAspectRatio", "xMinYMin slice");

	var defs = svg.append('svg:defs');
			defs.append("svg:pattern")
			.attr("id", "grump_avatar_blur")
			.attr("width", 1)
			.attr("height", 1)
            		.attr('patternContentUnits', 'objectBoundingBox')
			.append("svg:image")
			.attr("xlink:href", "images/surfer_blur2.png")
			.attr("width", 1)
			.attr("height", 1)
		        .attr("x", 0)
		        .attr("y", 0)
			.attr("preserveAspectRatio", "xMinYMin slice");

	//Pattern definitions-------------------------------------------------------


	  var circle = g.selectAll("circle")
	    .data(nodes_obj)
	    .enter().append("circle")
	      .attr("id", function(d,i){return "circle-"+i;})
	      .attr("class", function(d) { return d.parent ? d.children ? "node" : "node node--leaf" : "node node--root"; })
	      .style("fill", function(d) { return d.depth==1? "url(#grump_avatar)":color(d.depth); })
	      .on("click", function(d) {
				console.log(d.data.html)
			    var div = d3.select("#content")
					.attr('pointer-events', 'none')
				    	.attr("class", "tooltip")
				    	.style("opacity", 1)
				    	.html('<iframe src="prova.html" style="width: 100%; height: 100%; position: absolute;"></iframe>')
				    	.style("z-index", 2000);

			if (focus !== d){zoom(d), d3.event.stopPropagation()};
			})
	      .on("mouseover", function(d) { if(focus.depth==0 && d.depth==1) d3.select(this).style("fill", "url(#grump_avatar_blur)"); })
	      .on("mouseout", function(d) { if(focus.depth==0 && d.depth==1) d3.select(this).style("fill", "url(#grump_avatar)"); })
	      .style("display", function(d) { return (d.depth<=focus.depth+1) ? "inline" : "none"; });

/*
			if (focus.depth==0 && d.depth==1){ 
				d3.select(this).style("fill", "url(#grump_avatar_blur)").classed("selected", true);
			}
			if (focus.depth>0 && d.depth==1){ 
				d3.select(this).style("fill", "url(#grump_avatar)").classed("selected", false);
			}
*/

	  var text = g.selectAll("text")
	    .data(nodes_obj)
	    .enter().append("text")
	      .attr("class", "label")
	      .style("fill-opacity", function(d) { return d.parent === root ? 1 : 0; })
	      .style("display", function(d) { return d.parent === root ? "inline" : "none"; })
	      .text(function(d) { return d.data.name; });

	  var node = g.selectAll("circle,text.label");

	  

	  svg.style("background", "white")
	      .on("click", function() {
					zoom(root);
					g.select("circle#circle-1.node").transition().delay(750).style("fill", "url(#grump_avatar)")
					});

	  zoomTo([root.x, root.y, root.r * smallr *2 + margin]);


	  function zoom(d) {
		    var focus0 = focus; focus = d;



		    var trans = d3.transition()
			.duration(d3.event.altKey ? 7500 : 1100)
			.tween("zoom", function(d) {
			  if(focus==root){
				  var i = d3.interpolateZoom(view, [focus.x, focus.y, focus.r *smallr* 2 + margin]);
				  return function(t) { zoomTo(i(t)); };
			  }else{
				  if(focus.depth>1){
				  var i = d3.interpolateZoom(view, [focus.x, focus.y, focus.r * 2  + margin]);
				  }else{
				  var i = d3.interpolateZoom(view, [focus.x, focus.y, focus.r * 2 + margin]);
				  }
				  return function(t) { zoomTo(i(t)); };
			  }
			});


		    trans.selectAll("circle")
		      .filter(function(d) { return (d.depth<=focus.depth+1)  || this.style.display === "inline"; })
			.style("fill-opacity", function(d) { return (d.depth<=focus.depth+1) ? 1 : 0; })
			.on("start", function(d) { if (d.depth<=focus.depth+1)  this.style.display = "inline"; })
			.on("end", function(d) { if (d.depth>focus.depth+1)  this.style.display = "none"; });


		    trans.selectAll("text")
		      .filter(function(d) { return d.parent === focus || this.style.display === "inline"; })
			.style("fill-opacity", function(d) { return d.parent === focus ? 1 : 0; })
			.on("start", function(d) { if (d.parent === focus) this.style.display = "inline"; })
			.on("end", function(d) { if (d.parent !== focus) this.style.display = "none"; });

		    if (d.depth>2){d3.select("circle#circle-1.node").transition().delay(750).style("fill", "none");}
		    if (d.depth<=2){d3.select("circle#circle-1.node").transition().delay(700).style("fill", "url(#grump_avatar_blur)");}

	  }

	  function zoomTo(v) {
	    var k = diameter / v[2]; view = v;
	    node.attr("transform", function(d) { return "translate(" + (d.x - v[0]) * k + "," + (d.y - v[1]) * k + ")"; });
	    circle.attr("r", function(d) { return d.r * k; });
	  }
	});













</script>

</body>
</html>

